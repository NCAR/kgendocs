

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User Guide &mdash; KGen 0.8.0 documentation</title>
  

  
  
  
  

  

  
  
    
      <link rel="search" type="application/opensearchdescription+xml"
            title="Search within KGen 0.8.0 documentation"
            href="_static/opensearch.xml"/>
    

  

  <link rel="stylesheet" href="_static/networkx.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Developer Guide" href="developer/index.html" />
    <link rel="prev" title="Tutorial" href="tutorial/index.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> KGen
          

          
          </a>

          
            
            
              <div class="version">
                0.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting-started</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-use">2. How to use</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation">2.1 Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-line-syntax">2.2 Command-line syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-interface-for-specifying-a-kernel-to-be-extracted">2.3 User interface for specifying a kernel to be extracted</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#kgen-directive-user-interface">2.3.1 KGen directive user interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kgen-command-line-user-interface">2.3.2 KGen command-line user interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#supporting-kernel-generation-for-large-sized-software">2.4 Supporting kernel generation for large-sized software</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#namepath">2.4.1 Namepath</a></li>
<li class="toctree-l4"><a class="reference internal" href="#include-information">2.4.2 include information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#user-provided-exclude-information">2.4.3 User-provided exclude information</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#representativeness">3. Representativeness</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general">3.1 General</a></li>
<li class="toctree-l3"><a class="reference internal" href="#elapsed-time">3.2 Elapsed time</a></li>
<li class="toctree-l3"><a class="reference internal" href="#papi-hardware-counter">3.2 PAPI hardware counter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#source-code-coverage">3.2 Source code coverage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#command-line-options">4. Command line options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#known-issues">5. Known Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="#changes-from-kgen-ver-0-7-2">6. Changes from KGen ver. 0.7.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#user-interface">6.1 User Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#major-improvements">6.2 Major Improvements</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="developer/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/index.html">KGen Examples</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">KGen</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>User Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-guide">
<h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>KGen is a Python tool that extracts Fortran statements from a larger software and combines the extracted statements as a stand-alone application, aka kernel. It also saves input and output data that are used in the kernel for execution and verification purpose. From KGen version 0.8, KGen also can produce information about code coverage and PAPI counter for both of original Fortran application and generated kernel. Please see representativeness section below for details.</p>
<blockquote>
<div><img alt="_images/workflow2.png" src="_images/workflow2.png" />
</div></blockquote>
<p>General workflow for using KGen is shown in following figure. (A)To run KGen, user needs to provide four  arguments: a callsite location that specifies which part to be extracted and three types of Linux commands to clean/build/run target production application. Once KGen completes with success, it will produce a set of kernel source files (B) and a set of input and output data files (B). With the kernel files and data files, user can immediately compile (C) and run (D) the kernel as a stand-alone application and its outcome from execution is automatically verified against the generated output data.</p>
<p>In practice, user may adopt iterative workflow in using KGen. For example, it is generally unclear which external library should be excluded. User first provides KGen with minimum information and tries to generate a kernel. If it fails, in return, KGen may provide an user with what information was missed or what went wrong. In addition, KGen tries to create a kernel even though it can not find all required information and user may investigate the generated kernel further on missed information. User may re-try KGen by providing additional information, and repeat the steps.</p>
<p>This version of KGen is an integration of multiple KGen sub-applications running sequentially. The first part is to parse original Fortran application so that KGen can use Abstract Syntax Trees (ASTs) for later parts of operation. During this part, KGen builds the application to collect compiler arguments. Secondly, KGen collects data for several representativeness types including elapsed time, PAPI hardware counter, and source code coverage. This part is still experimental in that some feature is not fully automated yet. Please see representativeness section below for details. Lastly, KGen generate a kernel and input and output data.</p>
<p>KGen is being developed actively as of writing this document. It would be very helpful if you can share your experience on using KGen by sending relevant information to <a class="reference external" href="mailto:kgen&#37;&#52;&#48;ucar&#46;edu">kgen<span>&#64;</span>ucar<span>&#46;</span>edu</a>.</p>
</div>
<div class="section" id="how-to-use">
<h2>2. How to use<a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installation">
<h3>2.1 Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>Please see <a class="reference internal" href="getting-started.html"><span class="doc">Getting-started</span></a> for details</p>
</div>
<div class="section" id="command-line-syntax">
<h3>2.2 Command-line syntax<a class="headerlink" href="#command-line-syntax" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt;&gt; $PATH_TO_KGen/bin/kgen \
    --cmd-clean &lt;commands&gt; \
    --cmd-build &lt;commands&gt; \
    --cmd-run &lt;commands&gt; \
    [Other KGen options] \
    &lt;filepath&gt;[:&lt;namepath&gt;]

&lt;filepath&gt;[:&lt;namepath&gt;] : This argument specifies a file
    path that contains a callsite and namepath.
    Please see a section next for details.

--cmd-clean &lt;commands&gt;  : This mandatory option is Linux
    command(s) that ensure that next build commands
    actually compiles all source files that KGen requires
    to analyze.

--cmd-build &lt;commands&gt;  : This mandatory option is Linux
    command(s) that compiles target application.

--cmd-run &lt;commands&gt;    : This mandatory option is Linux
    command(s) that executes target application.
</pre></div>
</div>
<p>If there are multiple Linux commands, use semicolon between them. Use quotation marks if there are spaces in commands.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">example</span><span class="p">:</span>

<span class="n">kgen</span> <span class="n">callsite</span><span class="o">.</span><span class="n">F90</span> \
    <span class="s2">&quot;--cmd-clean cd $WORK; make clean&quot;</span> \
    <span class="s2">&quot;--cmd-build cd $WORK; make build&quot;</span> \
    <span class="s2">&quot;--cmd-run cd $WORK; make run&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="user-interface-for-specifying-a-kernel-to-be-extracted">
<h3>2.3 User interface for specifying a kernel to be extracted<a class="headerlink" href="#user-interface-for-specifying-a-kernel-to-be-extracted" title="Permalink to this headline">¶</a></h3>
<p>KGen supports two ways of user-interface for specifying a kernel location to be extracted: command-line and KGen directive.</p>
<p>KGen directives are inserted in source codes to directs what KGen to do.</p>
<div class="section" id="kgen-directive-user-interface">
<h4>2.3.1 KGen directive user interface<a class="headerlink" href="#kgen-directive-user-interface" title="Permalink to this headline">¶</a></h4>
<p>In general, the syntax of KGen directive follows OpenMP-like syntax. Case is not sensitive if not specified.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SYNTAX: !$kgen directive name/clause(s)
</pre></div>
</div>
<p>&#8220;directive&#8221; specifies the type of action. &#8220;name&#8221; or &#8220;clause(s)&#8221; is additional information for the directive. &#8220;name&#8221; is a non-space ascii string and &#8220;clause&#8221; is a name with having parenthesis.</p>
<p>Continuation of kgen directive is not supported yet.</p>
<p>Five KGen directives are implemented as of this version.</p>
<ul class="simple">
<li>&#8220;callsite&#8221; directive</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span>syntax: !$kgen callsite name

meaning: callsite directive specifies the location
of callsite Fortran statement in a source file.
If this directive is specified in source file,
user does not have to provide namepath on command-line.
namepath is a colon-separated names. See Namepath
section for more about namepath The directive should
be placed just before the callsite line. However,
blank line(s) and other comment lines are allowed
in-between. name is a user-provided string for kernel name.

example:
                !$kgen callsite kernelname
                CALL calc(i, j, output)
</pre></div>
</div>
<ul class="simple">
<li>&#8220;begin_callsite&#8221; and &#8220;end_callsite&#8221; directives</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span>syntax:
!$kgen begin_callsite name
... fortran statements...
!$kgen end_callsite

meaning: begin_callsite and end_callsite directives
specify a region of Fortran statements in a source
file to be extracted as a kernel.

example:
        !$kgen begin_callsite calc
        DO i=1, COL
            DO j=1, ROW
                CALL calc(i, j, output)
            END DO
        END DO
        !$kgen end_callsite calc
</pre></div>
</div>
<ul class="simple">
<li>&#8220;write&#8221; directive</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span>syntax: !$kgen write variable[,variable,...]

meaning: write directive specifies variables whose
content will be saved in state data files and will
be read by a generated kernel. By using this
directive, user can manually force KGen to save state
data at arbitrary points of source code. Multiple
variables can be specified by using comma in-between.
Variable can be a member of derived type. One
restriction of specifying variable is that it can
not be an element or partial elements of array.
For example, if A%B is an array it can not be
specified as A%B[index]. The directive can be
located anywhere within executable part of source code.

example:
            !$kgen write i,j
            CALL calc(i, j, output)
</pre></div>
</div>
<ul class="simple">
<li>&#8220;exclude&#8221; directive</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span>syntax: !$kgen exclude

meaning: exclude directive specifies that next statement
will be excluded during kernel generation. The main
purpose of this directive is to support MPI &quot;receiving&quot;
routines such as &quot;recv&quot; within generated kernel together
with &quot;write&quot; directive. For example, user can use &quot;write&quot;
directive to force KGen to read/write a variable and
&quot;exclude&quot; MPI receiving routine.

example:
            !$kgen write data
            !$kgen exclude
            CALL MPI_RECV(data, count, MPI_DOUBLE_PRECISION,
                from, tag, MPI_COMM_WORLD, status, ierr )
</pre></div>
</div>
</div>
<div class="section" id="kgen-command-line-user-interface">
<h4>2.3.2 KGen command-line user interface<a class="headerlink" href="#kgen-command-line-user-interface" title="Permalink to this headline">¶</a></h4>
<p>KGen can be invoked using command line interface too.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&gt;&gt; $PATH_TO_KGen/bin/kgen [KGen options] &lt;filepath&gt;[:&lt;namepath&gt;]
    &lt;clean commands&gt; &lt;build commands&gt; &lt;run commands&gt;
</pre></div>
</div>
<p>filepath is a path to a source file that contains a callsite region to be extracted. namepath tells KGen of the region of code to be extracted.  Please see namepath section 2.4.1 below for more detail.</p>
</div>
</div>
<div class="section" id="supporting-kernel-generation-for-large-sized-software">
<h3>2.4 Supporting kernel generation for large-sized software<a class="headerlink" href="#supporting-kernel-generation-for-large-sized-software" title="Permalink to this headline">¶</a></h3>
<div class="section" id="namepath">
<h4>2.4.1 Namepath<a class="headerlink" href="#namepath" title="Permalink to this headline">¶</a></h4>
<p>To resolve possible name conflict among different levels of namespace, KGen introduces a hierarchical representation of a name, called namepath.</p>
<p>Namepath is consecutive names with colons between them as a separator.  For example, if name B is inside of A, then it can be represented by A:B. In practice, it is used to specify  identifiers in KGen. For example, a kernel extraction region can be specified as following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">example</span><span class="p">)</span>
<span class="n">module</span> <span class="n">A</span>
    <span class="n">subroutine</span> <span class="n">B</span>
        <span class="n">CALL</span> <span class="n">C</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">end</span> <span class="n">subroutine</span> <span class="n">B</span>
<span class="n">end</span> <span class="n">module</span> <span class="n">A</span>
</pre></div>
</div>
<p>To specify CALL C(...) statement in above sample code, user can use A:B:C namepath.</p>
<p>To increase the usability of namepath, several syntactic features are added to above basic usage.</p>
<p>The separator of colon can be used as a metacharacter meaning of any similar to * in ls linux command. First, leading colon means any names can be placed before a name placed next to the colon. For example, :name_a means any namepath that ends with name_a. Similarly, colon at the end of a namepath means any names can be followed after a name placed before the colon. For example, name_a: matches to any namepath that starts with name_a. Finally, double colons between names means any names can be placed between the two names. For example, name_a::name_b matched to any namepaths that starts with name_a and ends with name_b</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Namepath</span> <span class="n">examples</span><span class="p">)</span>

<span class="n">C</span> <span class="o">=&gt;</span> <span class="n">A</span> <span class="n">name</span> <span class="n">that</span> <span class="n">has</span> <span class="n">only</span> <span class="n">one</span><span class="o">-</span><span class="n">level</span> <span class="n">whose</span> <span class="n">name</span>
    <span class="ow">is</span> <span class="n">C</span> <span class="n">such</span> <span class="k">as</span> <span class="n">module</span> <span class="n">C</span>

<span class="p">:</span><span class="n">C</span> <span class="o">=&gt;</span> <span class="nb">any</span> <span class="n">name</span> <span class="n">ends</span> <span class="k">with</span> <span class="n">C</span> <span class="n">such</span> <span class="k">as</span> <span class="nb">any</span> <span class="n">variable</span>
    <span class="ow">in</span> <span class="n">a</span> <span class="n">subroutine</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">module</span>

<span class="n">C</span><span class="p">:</span> <span class="o">=&gt;</span> <span class="nb">any</span> <span class="n">name</span> <span class="n">whose</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">name</span> <span class="ow">is</span> <span class="n">C</span> <span class="ow">and</span>
    <span class="n">may</span> <span class="n">contains</span> <span class="n">lower</span><span class="o">-</span><span class="n">level</span> <span class="n">names</span> <span class="n">such</span> <span class="k">as</span>
    <span class="nb">all</span> <span class="n">variables</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">subroutine</span> <span class="n">of</span> <span class="n">C</span>

<span class="p">:</span><span class="n">C</span><span class="p">:</span> <span class="o">=&gt;</span> <span class="nb">any</span> <span class="n">names</span> <span class="n">of</span> <span class="n">C</span> <span class="ow">in</span> <span class="nb">any</span> <span class="n">levels</span>

<span class="n">A</span><span class="p">::</span><span class="n">C</span> <span class="o">=&gt;</span> <span class="n">Any</span> <span class="n">names</span> <span class="n">whose</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">name</span> <span class="ow">is</span> <span class="n">A</span>
    <span class="ow">and</span> <span class="n">whose</span> <span class="n">lowest</span><span class="o">-</span><span class="n">level</span> <span class="n">name</span> <span class="ow">is</span> <span class="n">C</span>
</pre></div>
</div>
</div>
<div class="section" id="include-information">
<h4>2.4.2 include information<a class="headerlink" href="#include-information" title="Permalink to this headline">¶</a></h4>
<p>To analyze source code correctly, KGen requires to know what are macro definitions and include paths per each source file. KGen collects the information automatically through building target application under KGen control using strace utility. Once KGen collects the information, it generates include.ini text file in working directory. While, in simple case, user does not need to know the content of the file, there are cases that user-provided information in the file can help KGen to extract a kernel correctly and/or more efficiently.</p>
<p>Syntax of the INI file follows conventional INI file syntax. Brackets are used to specify sections. In a section, an option is added in a line or over multiple lines. Each option has a format of key and value pair with a separator of =. Value part can be missed depending on the type of option.</p>
<p>2.4.2.1 INI sections applicable to each source file</p>
<p>Some information has to be provided per each source file separately. As of this version, there are four types of information are identified in this category: macro definition,include directory, compiler path and compiler options. Following convention is used to provide these information in the INI file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="n">Path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">file</span> <span class="p">]</span>
<span class="n">include</span> <span class="o">=</span> <span class="p">[</span><span class="n">directory</span> <span class="n">path</span><span class="p">]:[</span><span class="n">directory</span> <span class="n">path</span><span class="p">]:</span><span class="o">...</span>
<span class="n">macro_name</span> <span class="o">=</span> <span class="n">macro_value</span>
<span class="o">...</span>
<span class="n">compiler</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">compiler</span>
<span class="n">compiler_options</span> <span class="o">=</span> <span class="n">compiler</span> <span class="n">options</span>

<span class="n">example</span><span class="p">)</span> <span class="n">When</span> <span class="n">program</span><span class="o">.</span><span class="n">F90</span> <span class="n">uses</span> <span class="n">a</span> <span class="n">module</span> <span class="ow">in</span> <span class="o">./</span><span class="n">module</span> <span class="n">directory</span><span class="p">,</span>
    <span class="ow">and</span> <span class="n">program</span><span class="o">.</span><span class="n">F90</span> <span class="n">needs</span> <span class="n">macro</span> <span class="n">definition</span> <span class="n">of</span> <span class="n">N</span><span class="o">=</span><span class="mi">10</span> <span class="k">with</span> <span class="n">intel</span>
    <span class="n">Fortran</span> <span class="n">compiler</span> <span class="ow">and</span> <span class="o">-</span><span class="n">O2</span> <span class="o">-</span><span class="n">fp</span><span class="o">-</span><span class="n">model</span> <span class="n">precise</span> <span class="n">option</span>

<span class="p">[</span><span class="n">program</span><span class="o">.</span><span class="n">F90</span><span class="p">]</span>
<span class="n">include</span> <span class="o">=</span> <span class="o">./</span><span class="n">module</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">compiler</span> <span class="o">=</span> <span class="n">ifort</span>
<span class="n">compiler_options</span> <span class="o">=</span> <span class="o">-</span><span class="n">O2</span> <span class="o">-</span><span class="n">fp</span><span class="o">-</span><span class="n">model</span> <span class="n">precise</span>
</pre></div>
</div>
<p>There can be multiple macro_name options but only one include, compiler, and compiler_options option is allowed per each file.</p>
<p>2.4.2.2 INI sections applicable to all source files</p>
<p>There are several types of information that can be applied to all source files that KGen analyzes.</p>
<p>Common macro definitions and include directories</p>
<p>In some cases, all source files may share the same macro definitions and/or include directories. In the cases, instead of specifying the information per each source file sections, user can use following sections.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">macro</span><span class="p">]</span>
<span class="n">macro_name</span> <span class="o">=</span> <span class="n">macro_value</span>
<span class="o">...</span>
</pre></div>
</div>
<p>These macros will be added to each source file during KGen analysis.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">include</span><span class="p">]</span>
<span class="n">include_path1</span> <span class="o">=</span>
<span class="n">include_path2</span> <span class="o">=</span>
<span class="o">...</span>
</pre></div>
</div>
<p>These include_paths will be added to each source file during KGen analysis. Note that each path should be specified per each line, which is different from the syntax of separate section for each file. Value part of each option should be blank for this version and is reserved for later use.</p>
<p>2.4.2.3 INI sections applicable to KGen operations</p>
<p>User can set a compiler command and compiler options to be used in extracted kernel.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">compiler</span><span class="p">]</span>
<span class="n">compiler</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">compiler</span>
<span class="n">compiler_options</span> <span class="o">=</span> <span class="n">compiler</span> <span class="n">options</span>
</pre></div>
</div>
<p>User can provide additional information to import source files or object files or library files through import section in a INI file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">import</span><span class="p">]</span>
<span class="n">filepath</span> <span class="o">=</span> <span class="n">action</span>
</pre></div>
</div>
<p>source and object and library actions are implemented as of this version. source action in import section provides KGen with paths to additional files to be analyzed before starting main parsing tasks. object action specifies a path to an object file that will be copied to kernel output directory. Library actions specifies a path to a folder contains libraries and name of library(similar to -L and -l compiler option)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">import</span><span class="p">]</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="n">file</span><span class="o">.</span><span class="n">F90</span> <span class="o">=</span> <span class="n">source</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="nb">object</span><span class="o">/</span><span class="n">file</span><span class="o">.</span><span class="n">o</span> <span class="o">=</span> <span class="nb">object</span>
<span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">folder</span><span class="o">/</span><span class="n">contains</span><span class="o">/</span><span class="n">library_files</span> <span class="o">=</span> <span class="n">library</span><span class="p">(</span><span class="n">libname</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="user-provided-exclude-information">
<h4>2.4.3 User-provided exclude information<a class="headerlink" href="#user-provided-exclude-information" title="Permalink to this headline">¶</a></h4>
<p>KGen accepts an INI-format file with -e command-line option. In the INI file, user can provide KGen with information of names( or namepaths) to be excluded during name search. Details of using the INI file are explained in following sections.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Command</span> <span class="n">line</span> <span class="n">option</span> <span class="nb">format</span><span class="p">:</span> <span class="o">-</span><span class="n">e</span> <span class="o">&lt;</span><span class="n">user</span><span class="o">-</span><span class="n">providing</span> <span class="n">INI</span> <span class="nb">format</span> <span class="n">file</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Syntax of the INI file follows conventional INI file syntax. Brackets are used to specify sections. In a section, a option is added in a line or over multiple lines.</p>
<p>2.4.3.1 namepath section</p>
<p>When namepath is specified in a section of INI file, actions specified in an option are applied to namepath in the option.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">namepath</span><span class="p">]</span>
<span class="n">namepath</span> <span class="o">=</span> <span class="p">[</span><span class="n">action</span><span class="p">]</span>
</pre></div>
</div>
<p>namepath in an option line specifies target of action. The syntax of namepath is explained in section 2.4.1.</p>
<p>Regardless of actions specified in an option line, any name in execution part of Fortran source codes that matches to namepaths will be skipped from name resolution in KGen. This is also true if there is no action is specified.</p>
<p>There are two actions defined in this version.</p>
<p>When skip_module is specified as action, KGen will not use a module specified by the namepath during name resolution tasks. This actions is useful when an module implemented in external library is used but not relevant to kernel extraction. By specifying this action, user can prune search tasks.</p>
<p>When remove_state is specified as action, KGen will not save state data specified by the namepath. This action may be useful discarding components of a derived type. If not all components of a derived type should be used for saving state data, user can specify components of the derived to be excluded from the state saving. This action may be used together with above skip_module action.</p>
</div>
</div>
</div>
<div class="section" id="representativeness">
<h2>3. Representativeness<a class="headerlink" href="#representativeness" title="Permalink to this headline">¶</a></h2>
<p>From version 0.8, KGen supports several features related to representativeness of a generated kernel.</p>
<div class="section" id="general">
<h3>3.1 General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h3>
<p>KGen version 8 include three types of representativeness extensions: 1) elapsed time, 2) PAPI (<a class="reference external" href="http://icl.utk.edu/papi/">http://icl.utk.edu/papi/</a>) hardware counter, and 3) source code coverage of Fortran IF construct. By adding command-line options explained in section 4, user can use the extensions. All extensions can be used with each other. Basic operations for the extensions start with measuring corresponding values of the kernel block from running original application. When completed the measurement, KGen saves measured values in &#8220;model.ini&#8221; file in output directory.</p>
<p>The file has a simple INI file format. To compare measurements between original applicatioin and kernel, user may want to read data from this file. Measured data are saved as options under a specified section in the INI file for each type of measurements. For example, &#8220;elapsed time&#8221; measurements are under &#8220;elapsedtime.elapsedtime&#8221; section, PAPI counters are under &#8220;papi.counters&#8221;, and code coverages are under &#8220;coverage.invoke&#8221; section. The format of each section are explained below.</p>
<p>The INI file is read by KGen to automatically generate a set of invocation triplets that maximize representativeness. User may set the maximum number of data files through sub-options as explained in Section 4.</p>
</div>
<div class="section" id="elapsed-time">
<h3>3.2 Elapsed time<a class="headerlink" href="#elapsed-time" title="Permalink to this headline">¶</a></h3>
<p>&#8220;&#8211;repr-etime&#8221; KGen command-option turns on the extension. This option is turned on as default so that user does not need to explictely enable this option. With this option enabled, KGen add &#8220;elapsed time&#8221; measurements under &#8220;elapsedtime.elapsedtime&#8221; INI section. The format of data is &#8220;&lt;MPI rank&gt; &lt;OpenMP thread&gt; &lt;Invocation order&gt; = &lt;start time&gt; &lt;stop time&gt;&#8221;. When generated kernel is executed, &#8220;elapsed time&#8221; data will be displayed on screen. User may compare the values on screen with ones in &#8220;model.ini&#8221; file. For details about the option, please see &#8220;Command line options&#8221; section.</p>
</div>
<div class="section" id="papi-hardware-counter">
<h3>3.2 PAPI hardware counter<a class="headerlink" href="#papi-hardware-counter" title="Permalink to this headline">¶</a></h3>
<p>&#8220;&#8211;repr-papi&#8221; KGen command-option turns on the extension. To use this option, user has to provide KGen with additional information: &lt;papi event name&gt;, &lt;path to PAPI fortran header file&gt;, and &lt;path to PAPI static library&gt;. With this option enabled, KGen add &#8220;papi hardware event&#8221; measurements under &#8220;papi.counters&#8221; INI section. The format of data is &#8220;&lt;MPI rank&gt; &lt;OpenMP thread&gt; &lt;Invocation order&gt; = &lt;event counts&gt;&#8221;. When generated kernel is built with &#8220;make papi&#8221; and executed, &#8220;papi counter&#8221; data will be displayed on screen. User may compare the values on screen with ones in &#8220;model.ini&#8221; file. For details about the option, please see &#8220;Command line options&#8221; section.</p>
</div>
<div class="section" id="source-code-coverage">
<h3>3.2 Source code coverage<a class="headerlink" href="#source-code-coverage" title="Permalink to this headline">¶</a></h3>
<p>&#8220;&#8211;repr-code&#8221; KGen command-option turns on the extension. With this option enabled, KGen add &#8220;code visits&#8221; measurements under &#8220;coverage.invoke&#8221; INI section. The format of data is &#8220;&lt;MPI rank&gt; &lt;OpenMP thread&gt; &lt;Invocation order&gt; = &lt;fileid&gt; &lt;line number&gt; &lt;number of visits&gt;&#8221;. Actual path of &#8220;fileid&#8221; is defined in &#8220;coverage.file&#8221; INI section. Coverage information can be found in generated source files having extension of &#8220;coverage&#8221; in &#8220;coverage&#8221; directory under output directory. For details about the option, please see &#8220;Command line options&#8221; section.</p>
</div>
</div>
<div class="section" id="command-line-options">
<h2>4. Command line options<a class="headerlink" href="#command-line-options" title="Permalink to this headline">¶</a></h2>
<p>The syntax of each options generally follows the following convention:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">General</span> <span class="n">KGen</span> <span class="n">option</span> <span class="n">syntax</span><span class="p">:</span>
<span class="o">-</span><span class="p">[</span><span class="o">-</span><span class="p">]</span><span class="o">&lt;</span><span class="n">option</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">suboption</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;=&lt;</span><span class="n">suboption</span><span class="o">-</span><span class="n">value</span><span class="o">&gt;</span>
    <span class="p">[,[</span><span class="o">&lt;</span><span class="n">suboption</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;=</span><span class="p">]</span><span class="o">&lt;</span><span class="n">suboption</span><span class="o">-</span><span class="n">value</span><span class="o">&gt;</span><span class="p">]]</span>
</pre></div>
</div>
<p>If there are multiple information in &lt;suboption-value&gt;, each information
would be separated by colon, :. Double or single quotation marks can be
used to use some of the separation symbols, such as equal sign, comma,
colon, in option value.</p>
<p>[-c or - -cmd-clean]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span><span class="p">:</span> <span class="n">This</span> <span class="n">mandatory</span> <span class="n">option</span> <span class="ow">is</span> <span class="n">Linux</span> <span class="n">command</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">that</span> <span class="n">ensure</span> <span class="n">that</span>
<span class="nb">next</span> <span class="n">build</span> <span class="n">commands</span> <span class="n">actually</span> <span class="n">compiles</span> <span class="nb">all</span> <span class="n">source</span> <span class="n">files</span> <span class="n">that</span> <span class="n">KGen</span>
<span class="n">requires</span> <span class="n">to</span> <span class="n">analyze</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">cmd</span><span class="o">-</span><span class="n">clean</span> <span class="n">cd</span> <span class="n">src</span><span class="p">;</span> <span class="n">make</span> <span class="n">clean</span>
</pre></div>
</div>
<p>[-b or - -cmd-build]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span><span class="p">:</span> <span class="n">This</span> <span class="n">mandatory</span> <span class="n">option</span> <span class="ow">is</span> <span class="n">Linux</span> <span class="n">command</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">that</span> <span class="n">compiles</span>
<span class="n">target</span> <span class="n">application</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">cmd</span><span class="o">-</span><span class="n">build</span> <span class="n">cd</span> <span class="n">src</span><span class="p">;</span> <span class="n">make</span> <span class="n">build</span>
</pre></div>
</div>
<p>[-r or - -cmd-run]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span><span class="p">:</span>  <span class="n">This</span> <span class="n">mandatory</span> <span class="n">option</span> <span class="ow">is</span> <span class="n">Linux</span> <span class="n">command</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">that</span> <span class="n">executes</span>
<span class="n">target</span> <span class="n">application</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">cmd</span><span class="o">-</span><span class="n">run</span> <span class="n">cd</span> <span class="n">src</span><span class="p">;</span> <span class="n">make</span> <span class="n">run</span>
</pre></div>
</div>
<p>[- -outdir]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span> <span class="p">:</span> <span class="n">KGen</span> <span class="n">output</span> <span class="n">directory</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">outdir</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">directory</span>
</pre></div>
</div>
<p>[- -rebuild]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span> <span class="p">:</span>  <span class="n">This</span> <span class="n">option</span> <span class="n">forces</span> <span class="n">KGen</span> <span class="n">generates</span> <span class="n">intermittent</span> <span class="n">files</span>
<span class="n">such</span> <span class="k">as</span> <span class="n">strace</span> <span class="n">log</span> <span class="n">files</span> <span class="ow">and</span> <span class="n">include</span><span class="o">.</span><span class="n">ini</span> <span class="n">files</span><span class="o">.</span> <span class="n">Current</span> <span class="n">version</span>
<span class="n">supports</span> <span class="n">strace</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">papi</span><span class="p">,</span> <span class="n">coverage</span><span class="p">,</span> <span class="ow">and</span> <span class="n">etime</span> <span class="n">sub</span><span class="o">-</span><span class="n">options</span><span class="o">.</span>
<span class="n">strace</span> <span class="n">forces</span> <span class="n">to</span> <span class="n">rebuild</span> <span class="n">strace</span><span class="o">.</span><span class="n">log</span> <span class="n">file</span><span class="o">.</span> <span class="n">include</span> <span class="n">forces</span> <span class="n">to</span> <span class="n">rebuild</span>
<span class="n">include</span><span class="o">.</span><span class="n">ini</span> <span class="n">file</span><span class="o">.</span> <span class="n">state</span> <span class="n">forces</span> <span class="n">to</span> <span class="n">rebuild</span> <span class="n">state</span> <span class="n">data</span> <span class="n">files</span><span class="o">.</span> <span class="n">papi</span><span class="p">,</span>
<span class="n">coverage</span><span class="p">,</span> <span class="ow">and</span> <span class="n">etime</span> <span class="n">sub</span><span class="o">-</span><span class="n">options</span> <span class="n">forces</span> <span class="n">KGen</span> <span class="n">to</span> <span class="n">recollect</span>
<span class="n">representativeness</span> <span class="n">data</span> <span class="k">for</span> <span class="n">PAPI</span> <span class="n">counter</span><span class="p">,</span> <span class="n">source</span> <span class="n">code</span> <span class="n">coverage</span><span class="p">,</span>
<span class="ow">and</span> <span class="n">elapsed</span> <span class="n">time</span><span class="o">.</span> <span class="n">All</span> <span class="n">sub</span><span class="o">-</span><span class="n">option</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">same</span> <span class="n">to</span> <span class="n">using</span> <span class="nb">all</span> <span class="n">of</span> <span class="n">the</span>
<span class="n">three</span> <span class="n">sub</span><span class="o">-</span><span class="n">options</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">rebuild</span> <span class="n">strace</span><span class="p">,</span><span class="n">include</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">papi</span><span class="p">,</span><span class="n">coverage</span><span class="p">,</span><span class="n">etime</span>
</pre></div>
</div>
<p>[- -prerun]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span> <span class="p">:</span>  <span class="n">This</span> <span class="n">options</span> <span class="n">provide</span> <span class="n">a</span> <span class="n">way</span> <span class="k">for</span> <span class="n">user</span> <span class="n">to</span> <span class="n">specify</span>
<span class="n">Linux</span> <span class="n">commands</span> <span class="n">that</span> <span class="n">are</span> <span class="n">executed</span> <span class="n">before</span> <span class="n">KGen</span> <span class="n">executes</span> <span class="n">Linux</span>
<span class="n">shell</span> <span class="n">command</span> <span class="n">at</span> <span class="n">several</span> <span class="n">stages</span> <span class="n">during</span> <span class="n">kernel</span> <span class="n">extraction</span><span class="o">.</span>
<span class="n">There</span> <span class="n">are</span> <span class="n">five</span> <span class="n">sub</span><span class="o">-</span><span class="n">options</span> <span class="n">are</span> <span class="n">supported</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">version</span><span class="p">:</span>
<span class="n">clean</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">kernel_build</span> <span class="ow">and</span> <span class="n">kerne_run</span><span class="o">.</span> <span class="n">A</span> <span class="n">argument</span>
<span class="n">of</span> <span class="n">each</span> <span class="n">sub</span><span class="o">-</span><span class="n">commands</span> <span class="n">are</span> <span class="n">executed</span> <span class="n">before</span> <span class="n">executing</span> <span class="n">clean</span>
<span class="n">commands</span><span class="p">,</span> <span class="n">build</span> <span class="n">commands</span> <span class="ow">and</span> <span class="n">run</span> <span class="n">command</span> <span class="k">for</span> <span class="n">target</span> <span class="n">application</span><span class="p">,</span>
<span class="ow">and</span> <span class="n">build</span> <span class="n">command</span> <span class="ow">and</span> <span class="n">run</span> <span class="n">command</span> <span class="k">for</span> <span class="n">KGen</span> <span class="n">generated</span> <span class="n">kernel</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">prerun</span> <span class="n">build</span><span class="o">=</span><span class="n">module</span> <span class="n">load</span> <span class="n">intel</span><span class="p">;</span> <span class="n">module</span> <span class="n">load</span> <span class="n">impi</span><span class="p">;</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">mkl</span>
</pre></div>
</div>
<p>[-I]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span><span class="p">:</span> <span class="n">specify</span> <span class="n">paths</span> <span class="k">for</span> <span class="n">searching</span> <span class="n">source</span> <span class="n">files</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">-</span><span class="n">I</span> <span class="o">./</span><span class="n">src</span>
</pre></div>
</div>
<p>[-D]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span><span class="p">:</span> <span class="n">specify</span> <span class="n">macros</span> <span class="n">that</span> <span class="n">will</span> <span class="n">be</span> <span class="n">replaced</span> <span class="ow">in</span> <span class="n">source</span> <span class="n">files</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">-</span><span class="n">D</span> <span class="n">ROWS</span><span class="o">=</span><span class="mi">4</span>
</pre></div>
</div>
<p>[-i or - -include-ini]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span><span class="p">:</span> <span class="n">specify</span> <span class="n">paths</span> <span class="k">for</span> <span class="n">include</span> <span class="n">INI</span> <span class="n">file</span><span class="o">.</span> <span class="n">If</span> <span class="n">include</span> <span class="n">INI</span>
<span class="n">file</span> <span class="ow">is</span> <span class="n">specified</span><span class="p">,</span> <span class="n">KGen</span> <span class="n">uses</span> <span class="n">the</span> <span class="n">file</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">generating</span>
<span class="n">new</span> <span class="n">include</span> <span class="n">INI</span> <span class="n">file</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">include</span><span class="o">-</span><span class="n">ini</span> <span class="o">./</span><span class="n">include</span><span class="o">.</span><span class="n">ini</span>
</pre></div>
</div>
<p>[- -invocation]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span> <span class="p">:</span> <span class="n">specifies</span> <span class="n">invocatioin</span> <span class="n">triples</span><span class="o">.</span> <span class="n">From</span> <span class="n">KGen</span> <span class="n">version</span> <span class="mf">0.8</span><span class="p">,</span>
<span class="n">user</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">have</span> <span class="n">to</span> <span class="n">specify</span> <span class="n">this</span> <span class="n">option</span> <span class="k">as</span> <span class="n">KGen</span> <span class="n">automatically</span>
<span class="n">generate</span> <span class="n">invocation</span> <span class="n">triples</span><span class="o">.</span> <span class="n">However</span><span class="p">,</span> <span class="n">user</span> <span class="n">can</span> <span class="n">still</span> <span class="n">use</span> <span class="n">this</span>
<span class="n">option</span> <span class="n">to</span> <span class="n">manually</span> <span class="n">add</span> <span class="n">specific</span> <span class="n">invocation</span> <span class="n">triples</span><span class="o">.</span> <span class="n">Please</span> <span class="n">see</span>
<span class="n">representativeness</span> <span class="n">section</span> <span class="k">for</span> <span class="n">details</span><span class="o">.</span>

<span class="n">syntax</span><span class="p">:</span> <span class="n">mpirank</span><span class="p">:</span><span class="n">openmpnum</span><span class="p">:</span><span class="n">invocation</span><span class="p">[,</span><span class="n">mpirank</span><span class="p">:</span><span class="n">openmpnum</span><span class="p">:</span><span class="n">invocation</span><span class="p">[</span><span class="o">...</span><span class="p">]]</span>

<span class="n">examples</span>
  <span class="o">--</span><span class="n">invocation</span>  <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span>  <span class="o">=&gt;</span> <span class="n">mpi</span> <span class="n">rank0</span><span class="p">,</span> <span class="n">openmp</span> <span class="n">num</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">and</span> <span class="n">second</span>
    <span class="n">invocation</span> <span class="n">of</span> <span class="n">the</span> <span class="n">kernel</span><span class="p">(</span><span class="n">starts</span> <span class="kn">from</span> <span class="mi">1</span><span class="p">)</span>
  <span class="o">--</span><span class="n">invocation</span>  <span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="mi">5</span><span class="o">-</span><span class="mi">6</span> <span class="o">=&gt;</span> <span class="n">mpi</span> <span class="n">rank1</span> <span class="ow">and</span> <span class="mi">2</span><span class="p">,</span> <span class="n">openmp</span> <span class="n">num</span> <span class="mi">3</span>
    <span class="ow">and</span> <span class="mi">4</span><span class="p">,</span> <span class="ow">and</span> <span class="n">fifth</span> <span class="ow">and</span> <span class="n">sixth</span> <span class="n">invocations</span> <span class="n">of</span> <span class="n">the</span> <span class="n">kernel</span>
</pre></div>
</div>
<p>Use 0 for &#8220;non MPI application&#8221; and use 0 for &#8220;non OpenMP application&#8221;
in the first and second part of the syntax.</p>
<p>[-e or - -exclude-ini]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span><span class="p">:</span> <span class="n">specify</span> <span class="n">paths</span> <span class="k">for</span> <span class="n">an</span> <span class="n">exclude</span> <span class="n">INI</span> <span class="n">file</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">exclude</span> <span class="o">./</span><span class="n">exclude</span><span class="o">.</span><span class="n">ini</span>
</pre></div>
</div>
<p>[- -kernel-option]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span> <span class="p">:</span> <span class="n">compiler</span><span class="o">-</span><span class="n">specific</span> <span class="n">information</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">generating</span>
<span class="n">Makefile</span> <span class="k">for</span> <span class="n">kernel</span><span class="o">.</span> <span class="n">Two</span> <span class="n">sub</span><span class="o">-</span><span class="n">options</span> <span class="n">are</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">this</span>
<span class="n">version</span><span class="p">:</span> <span class="n">FC</span> <span class="ow">and</span> <span class="n">FC_FLAGS</span><span class="o">.</span> <span class="n">User</span> <span class="n">can</span> <span class="n">choose</span> <span class="n">which</span> <span class="n">Fortran</span>
<span class="n">compiler</span> <span class="n">to</span> <span class="n">be</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">kernel</span> <span class="n">makefile</span> <span class="k">with</span> <span class="n">FC</span> <span class="n">flag</span><span class="o">.</span>
<span class="n">If</span> <span class="n">user</span> <span class="n">also</span> <span class="n">provide</span> <span class="n">the</span> <span class="n">same</span> <span class="n">information</span> <span class="ow">in</span> <span class="n">include</span><span class="o">.</span><span class="n">ini</span>
<span class="n">file</span><span class="p">,</span> <span class="n">FC</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">option</span> <span class="n">overwrite</span> <span class="n">previous</span> <span class="n">setting</span> <span class="ow">and</span>
<span class="n">FC_FLAGS</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">option</span> <span class="n">added</span> <span class="n">to</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">included</span><span class="o">.</span><span class="n">ini</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">kernel</span><span class="o">-</span><span class="n">option</span> <span class="n">FC</span><span class="o">=</span><span class="n">ifort</span><span class="p">,</span><span class="n">FC_FLAGS</span><span class="o">=-</span><span class="n">O3</span>
</pre></div>
</div>
<p>[- -mpi]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span> <span class="p">:</span> <span class="n">Turns</span> <span class="n">on</span> <span class="n">MPI</span> <span class="n">supports</span> <span class="ow">in</span> <span class="n">KGen</span><span class="o">.</span> <span class="n">There</span> <span class="n">are</span> <span class="n">several</span>
<span class="n">sub</span><span class="o">-</span><span class="n">options</span><span class="p">:</span> <span class="n">enable</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">use</span><span class="p">,</span> <span class="ow">and</span> <span class="n">header</span><span class="o">.</span> <span class="n">enable</span> <span class="n">specifies</span>
<span class="n">that</span> <span class="n">KGen</span> <span class="n">extracts</span> <span class="n">a</span> <span class="n">kernel</span> <span class="kn">from</span> <span class="nn">MPI</span> <span class="n">application</span><span class="o">.</span> <span class="n">This</span> <span class="ow">is</span>
<span class="n">a</span> <span class="n">mandatory</span> <span class="k">for</span> <span class="n">MPI</span> <span class="n">application</span><span class="o">.</span> <span class="n">comm</span> <span class="n">specified</span> <span class="n">the</span> <span class="n">names</span>
<span class="n">of</span> <span class="n">variable</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">when</span> <span class="n">MPI</span> <span class="n">call</span> <span class="ow">is</span> <span class="n">made</span><span class="o">.</span> <span class="n">Default</span>
<span class="n">comm</span> <span class="ow">is</span> <span class="n">MPI_COMM_WORLD</span><span class="o">.</span> <span class="n">use</span> <span class="n">specifies</span> <span class="n">Fortran</span> <span class="n">module</span> <span class="n">name</span>
<span class="n">whose</span> <span class="n">name</span> <span class="ow">is</span> <span class="n">inserted</span> <span class="ow">in</span> <span class="n">additional</span> <span class="n">Fortran</span> <span class="n">use</span> <span class="n">statement</span><span class="o">.</span>
<span class="n">There</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">default</span> <span class="n">value</span> <span class="k">for</span> <span class="n">use</span><span class="o">.</span> <span class="n">header</span> <span class="n">specifies</span> <span class="n">the</span> <span class="n">path</span>
<span class="n">to</span> <span class="n">MPI</span> <span class="n">header</span> <span class="n">file</span><span class="o">.</span> <span class="n">Default</span> <span class="n">header</span> <span class="ow">is</span> <span class="n">mpif</span><span class="o">.</span><span class="n">h</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">mpi</span> <span class="n">ranks</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">comm</span><span class="o">=</span><span class="n">mpicom</span><span class="p">,</span><span class="n">use</span><span class="o">=</span><span class="s2">&quot;spmd_utils:mpicom&quot;</span>
</pre></div>
</div>
<p>[- -openmp]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span> <span class="p">:</span> <span class="n">Turns</span> <span class="n">on</span> <span class="n">OpenMP</span> <span class="n">supports</span> <span class="ow">in</span> <span class="n">KGen</span><span class="o">.</span> <span class="n">There</span> <span class="ow">is</span> <span class="n">two</span>
<span class="n">sub</span><span class="o">-</span><span class="n">options</span><span class="p">:</span> <span class="s2">&quot;enable&quot;</span> <span class="ow">and</span> <span class="s2">&quot;kernel-in-critical-region&quot;</span><span class="o">.</span>
<span class="s2">&quot;enable&quot;</span> <span class="n">specifies</span> <span class="n">that</span> <span class="n">KGen</span> <span class="n">extracts</span> <span class="n">a</span> <span class="n">kernel</span> <span class="kn">from</span>
<span class="nn">OpenMP</span> <span class="n">application</span><span class="o">.</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">mandatory</span> <span class="k">for</span> <span class="n">OpenMP</span>
<span class="n">application</span><span class="o">.</span> <span class="s2">&quot;kernel-in-critical-region&quot;</span> <span class="n">can</span> <span class="n">has</span> <span class="n">one</span> <span class="n">of</span>
<span class="n">two</span> <span class="n">values</span><span class="p">:</span> <span class="s2">&quot;yes&quot;</span> <span class="ow">or</span> <span class="s2">&quot;no&quot;</span><span class="o">.</span> <span class="n">If</span> <span class="s2">&quot;kernel-in-critical-region&quot;</span>
<span class="ow">is</span> <span class="nb">set</span> <span class="n">to</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="n">kernel</span> <span class="n">region</span> <span class="ow">is</span> <span class="n">encompassed</span> <span class="n">by</span> <span class="n">OpenMP</span>
<span class="n">Critical</span> <span class="n">region</span><span class="p">,</span> <span class="n">which</span> <span class="n">improves</span> <span class="n">correctness</span> <span class="n">of</span> <span class="n">generated</span>
<span class="n">state</span> <span class="n">data</span><span class="o">.</span> <span class="n">However</span><span class="p">,</span> <span class="n">this</span> <span class="n">may</span> <span class="n">cause</span> <span class="n">deadlock</span> <span class="k">if</span> <span class="n">OpenMP</span>
<span class="n">Barrier</span> <span class="ow">is</span> <span class="n">used</span> <span class="n">within</span> <span class="n">the</span> <span class="n">kernel</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">openmp</span> <span class="n">kernel</span><span class="o">-</span><span class="ow">in</span><span class="o">-</span><span class="n">critical</span><span class="o">-</span><span class="n">region</span><span class="o">=</span><span class="n">yes</span>
</pre></div>
</div>
<p>[- -intrinsic]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span> <span class="p">:</span> <span class="n">options</span> <span class="n">to</span> <span class="n">let</span> <span class="n">KGen</span> <span class="n">skip</span> <span class="n">searching</span> <span class="k">for</span> <span class="n">names</span> <span class="n">of</span>
<span class="n">intrinsic</span><span class="o">-</span><span class="n">procedures</span><span class="o">.</span> <span class="n">At</span> <span class="n">minimum</span><span class="p">,</span> <span class="n">one</span> <span class="n">of</span> <span class="n">skip</span> <span class="ow">or</span> <span class="n">noskip</span>
<span class="n">should</span> <span class="n">be</span> <span class="n">provided</span><span class="o">.</span> <span class="n">With</span> <span class="k">except</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span><span class="p">,</span> <span class="n">user</span> <span class="n">can</span> <span class="n">specify</span>
<span class="n">which</span> <span class="n">namepath</span> <span class="n">should</span> <span class="n">be</span> <span class="n">considered</span> <span class="k">as</span> <span class="n">exception</span><span class="o">.</span>
<span class="n">With</span> <span class="n">add</span><span class="o">-</span><span class="n">intrinsic</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span><span class="p">,</span> <span class="n">user</span> <span class="n">can</span> <span class="n">add</span> <span class="n">new</span> <span class="n">intrinsic</span>
<span class="n">function</span> <span class="n">names</span><span class="o">.</span> <span class="n">default</span><span class="p">:</span> <span class="o">--</span><span class="n">intrinsic</span> <span class="n">skip</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">intrinsic</span> <span class="n">skip</span><span class="p">,</span><span class="k">except</span><span class="o">=</span><span class="n">mod_A</span><span class="o">.</span><span class="n">subr_B</span><span class="o">.</span><span class="n">sum</span>
</pre></div>
</div>
<p>[- -verbose]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span><span class="p">:</span> <span class="n">This</span> <span class="n">flag</span> <span class="n">sets</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">verbosity</span> <span class="n">level</span> <span class="ow">in</span>
<span class="n">the</span> <span class="n">generated</span> <span class="n">kernel</span><span class="o">.</span> <span class="n">Default</span> <span class="n">value</span> <span class="ow">is</span> <span class="mf">1.</span> <span class="n">User</span> <span class="n">can</span>
<span class="n">modify</span> <span class="n">the</span> <span class="n">verbosity</span> <span class="n">level</span> <span class="n">by</span> <span class="n">changing</span> <span class="n">the</span> <span class="n">verbosity</span>
<span class="n">value</span> <span class="n">up</span> <span class="n">to</span> <span class="mf">3.</span> <span class="n">User</span> <span class="n">also</span> <span class="n">can</span> <span class="n">modify</span> <span class="n">verbosity</span> <span class="n">level</span> <span class="n">by</span>
<span class="n">modifying</span> <span class="n">the</span> <span class="n">value</span> <span class="n">hardcoded</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">generated</span> <span class="n">kernel</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">verbose</span> <span class="mi">3</span>
</pre></div>
</div>
<p>[&#8211;check]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span><span class="p">:</span> <span class="n">This</span> <span class="n">flag</span> <span class="n">provides</span> <span class="n">KGen</span> <span class="k">with</span> <span class="n">correctness</span>
<span class="n">check</span><span class="o">-</span><span class="n">related</span> <span class="n">information</span><span class="o">.</span> <span class="n">Current</span> <span class="n">implementation</span> <span class="n">only</span>
<span class="n">allows</span> <span class="n">perturbation</span> <span class="n">related</span> <span class="n">information</span><span class="o">.</span> <span class="n">pert_invar</span>
<span class="n">sub</span><span class="o">-</span><span class="n">flag</span> <span class="n">select</span> <span class="n">an</span> <span class="nb">input</span> <span class="n">variable</span> <span class="k">for</span> <span class="n">perturbation</span> <span class="n">test</span><span class="o">.</span>
<span class="n">Pert_lim</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span> <span class="n">sets</span> <span class="n">the</span> <span class="n">magnitude</span> <span class="n">of</span> <span class="n">perturbation</span><span class="o">.</span>
<span class="n">Default</span> <span class="n">value</span> <span class="ow">is</span> <span class="s1">&#39;1.0E-15&#39;</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">check</span> <span class="n">pert_invar</span><span class="o">=</span><span class="n">varname</span><span class="p">,</span><span class="n">pert_lim</span><span class="o">=</span><span class="mf">1.0E-7</span>
</pre></div>
</div>
<p>[- -add-mpi-frame]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span><span class="p">:</span> <span class="n">This</span> <span class="n">flag</span> <span class="n">specify</span> <span class="n">to</span> <span class="n">create</span> <span class="n">MPI</span> <span class="n">framework</span> <span class="k">for</span>
<span class="n">replicating</span> <span class="n">kernel</span> <span class="n">execution</span> <span class="n">across</span> <span class="n">multiple</span> <span class="n">MPI</span>
<span class="n">ranks</span><span class="o">.</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">simple</span> <span class="n">duplication</span> <span class="n">of</span> <span class="n">kernel</span> <span class="n">execution</span>
<span class="n">without</span> <span class="n">having</span> <span class="nb">any</span> <span class="n">communication</span> <span class="n">among</span> <span class="n">kernels</span><span class="o">.</span>
<span class="n">Two</span> <span class="n">sub</span><span class="o">-</span><span class="n">options</span> <span class="n">are</span> <span class="n">allowed</span><span class="p">:</span> <span class="n">np</span> <span class="ow">and</span> <span class="n">mpiexec</span><span class="o">.</span> <span class="n">np</span> <span class="n">sets</span>
<span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">MPI</span> <span class="n">ranks</span> <span class="ow">and</span> <span class="n">mpiexec</span> <span class="n">sets</span> <span class="n">the</span> <span class="n">path</span> <span class="n">to</span>
<span class="n">mpiexec</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">mpi</span><span class="o">-</span><span class="n">frame</span><span class="o">=</span><span class="n">np</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mpiexec</span><span class="o">=</span><span class="n">mpirun</span>
</pre></div>
</div>
<p>[- -source]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span> <span class="p">:</span> <span class="n">this</span> <span class="n">options</span> <span class="n">specifies</span> <span class="n">information</span> <span class="n">related</span>
<span class="n">to</span> <span class="n">source</span> <span class="n">file</span><span class="o">.</span> <span class="nb">format</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span> <span class="n">specifies</span> <span class="n">the</span> <span class="n">Fortran</span>
<span class="nb">format</span> <span class="n">of</span> <span class="n">source</span> <span class="n">files</span> <span class="n">fixed</span> <span class="ow">is</span> <span class="n">used</span> <span class="k">for</span> <span class="n">F77</span> <span class="nb">format</span>
<span class="ow">and</span> <span class="n">free</span> <span class="n">used</span> <span class="k">for</span> <span class="n">F90</span> <span class="ow">and</span> <span class="n">later</span> <span class="nb">format</span><span class="o">.</span> <span class="n">With</span> <span class="n">this</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span><span class="p">,</span>
<span class="n">KGen</span> <span class="n">forces</span> <span class="n">to</span> <span class="n">use</span> <span class="n">the</span> <span class="n">specified</span> <span class="nb">format</span> <span class="n">regardless</span> <span class="n">of</span>
<span class="n">file</span> <span class="n">extension</span><span class="o">.</span> <span class="n">strict</span> <span class="nb">format</span> <span class="n">let</span> <span class="n">parser</span> <span class="n">of</span> <span class="n">KGen</span> <span class="n">informe</span>
<span class="n">to</span> <span class="n">apply</span> <span class="nb">format</span> <span class="n">strictly</span> <span class="ow">or</span> <span class="ow">not</span><span class="o">.</span> <span class="n">Default</span> <span class="ow">is</span> <span class="n">of</span>
<span class="n">the</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span> <span class="ow">is</span> <span class="n">no</span><span class="p">,</span> <span class="n">alias</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span> <span class="n">create</span> <span class="n">path</span> <span class="n">alias</span><span class="o">.</span>
<span class="n">This</span> <span class="ow">is</span> <span class="n">useful</span> <span class="k">if</span> <span class="n">you</span> <span class="n">have</span> <span class="n">one</span> <span class="n">file</span> <span class="n">physical</span> <span class="n">location</span>
<span class="n">but</span> <span class="n">has</span> <span class="n">two</span> <span class="n">different</span> <span class="n">paths</span> <span class="n">that</span> <span class="n">points</span> <span class="n">the</span> <span class="n">same</span> <span class="n">physical</span> <span class="n">path</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">source</span> <span class="nb">format</span><span class="o">=</span><span class="n">free</span><span class="p">,</span><span class="n">strict</span><span class="o">=</span><span class="n">no</span><span class="p">,</span><span class="n">alias</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">A</span><span class="p">:</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">B</span>
</pre></div>
</div>
<p>[&#8211;repr-etime]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span> <span class="p">:</span> <span class="n">this</span> <span class="n">option</span> <span class="n">enables</span> <span class="n">to</span> <span class="n">measure</span> <span class="n">elapsed</span> <span class="n">time</span> <span class="n">of</span>
<span class="n">callsite</span> <span class="k">while</span> <span class="n">running</span> <span class="n">original</span> <span class="n">application</span><span class="o">.</span> <span class="n">KGen</span> <span class="n">uses</span>
<span class="n">the</span> <span class="n">measruments</span> <span class="n">to</span> <span class="n">automatically</span> <span class="n">generate</span> <span class="n">invocation</span>
<span class="n">triplets</span><span class="o">.</span> <span class="n">This</span> <span class="n">option</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="k">with</span> <span class="n">other</span> <span class="s2">&quot;repr-&quot;</span>
<span class="n">options</span><span class="o">.</span> <span class="n">Current</span> <span class="n">KGen</span> <span class="n">version</span> <span class="n">tries</span> <span class="n">select</span> <span class="n">invocation</span>
<span class="n">triplets</span> <span class="n">such</span> <span class="n">a</span> <span class="n">way</span> <span class="n">to</span> <span class="n">improve</span> <span class="n">kernel</span> <span class="n">representativeness</span>
<span class="ow">in</span> <span class="n">terms</span> <span class="n">of</span> <span class="n">distribution</span> <span class="n">of</span> <span class="n">the</span> <span class="n">measurments</span><span class="o">.</span> <span class="n">There</span> <span class="n">are</span>
<span class="n">several</span> <span class="n">sub</span><span class="o">-</span><span class="n">flags</span> <span class="n">that</span> <span class="n">control</span> <span class="n">specific</span> <span class="n">aspects</span> <span class="n">of</span> <span class="n">this</span>
<span class="n">option</span><span class="o">.</span> <span class="s2">&quot;enable&quot;</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span> <span class="n">turns</span> <span class="n">on</span> <span class="n">this</span> <span class="n">feature</span><span class="o">.</span> <span class="n">As</span> <span class="n">this</span>
<span class="n">option</span> <span class="ow">is</span> <span class="n">enalbed</span> <span class="k">as</span> <span class="n">default</span><span class="p">,</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">redundant</span> <span class="k">as</span> <span class="n">itself</span><span class="o">.</span>
<span class="n">However</span><span class="p">,</span> <span class="ow">in</span> <span class="n">case</span> <span class="n">that</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">sub</span><span class="o">-</span><span class="n">flags</span> <span class="n">used</span><span class="p">,</span> <span class="n">this</span>
<span class="s2">&quot;enable&quot;</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span> <span class="n">should</span> <span class="n">be</span> <span class="n">used</span><span class="o">.</span> <span class="s2">&quot;disable&quot;</span> <span class="n">turns</span> <span class="n">off</span> <span class="n">this</span>
<span class="n">feature</span><span class="o">.</span> <span class="s2">&quot;minval&quot;</span> <span class="ow">and</span> <span class="s2">&quot;maxval&quot;</span> <span class="n">sub</span><span class="o">-</span><span class="n">flags</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">lower</span> <span class="ow">and</span>
<span class="n">upper</span> <span class="n">bounds</span> <span class="n">of</span> <span class="n">measurements</span> <span class="ow">in</span> <span class="n">unit</span> <span class="n">of</span> <span class="n">second</span><span class="o">.</span> <span class="n">By</span> <span class="n">setting</span>
<span class="n">these</span> <span class="n">sub</span><span class="o">-</span><span class="n">flags</span><span class="p">,</span> <span class="n">user</span> <span class="n">can</span> <span class="n">manually</span> <span class="n">exclude</span> <span class="s2">&quot;outliers&quot;</span> <span class="n">that</span>
<span class="n">are</span> <span class="ow">not</span> <span class="n">likely</span> <span class="n">part</span> <span class="n">of</span> <span class="n">measurements</span><span class="o">.</span> <span class="s2">&quot;ndata&quot;</span> <span class="n">sets</span> <span class="n">the</span> <span class="n">number</span>
<span class="n">of</span> <span class="n">invocation</span> <span class="n">triplets</span> <span class="n">that</span> <span class="n">KGen</span> <span class="n">automatically</span> <span class="n">genrates</span><span class="o">.</span>
<span class="s2">&quot;nbins&quot;</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">elapsed</span> <span class="n">time</span> <span class="n">ranges</span> <span class="n">that</span>
<span class="n">controls</span> <span class="n">resolution</span> <span class="n">of</span> <span class="n">distribution</span><span class="o">.</span> <span class="s2">&quot;timer&quot;</span> <span class="n">sets</span> <span class="n">the</span> <span class="nb">type</span>
<span class="n">of</span> <span class="n">timing</span> <span class="n">measurement</span> <span class="n">methods</span><span class="o">.</span> <span class="n">Current</span> <span class="n">version</span> <span class="n">supports</span>
<span class="s2">&quot;mpiwtime&quot;</span><span class="p">,</span> <span class="s2">&quot;ompwtime&quot;</span><span class="p">,</span> <span class="s2">&quot;cputime&quot;</span><span class="p">,</span> <span class="ow">and</span> <span class="s2">&quot;sysclock&quot;</span><span class="o">.</span> <span class="n">The</span> <span class="n">name</span>
<span class="n">of</span> <span class="n">timers</span> <span class="n">follows</span> <span class="n">the</span> <span class="n">name</span> <span class="n">library</span> <span class="n">routine</span> <span class="ow">or</span> <span class="n">intrinsic</span>
<span class="n">subroutines</span> <span class="k">as</span> <span class="n">name</span> <span class="n">indicates</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="nb">repr</span><span class="o">-</span><span class="n">etime</span> <span class="n">minval</span><span class="o">=</span><span class="mf">0.5</span><span class="n">D</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="n">maxval</span><span class="o">=</span><span class="mf">1.0</span><span class="n">D</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ndata</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">nbins</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">timer</span><span class="o">=</span><span class="n">sysclock</span>
</pre></div>
</div>
<p>[- -repr-papi]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span> <span class="p">:</span> <span class="n">this</span> <span class="n">option</span> <span class="n">enables</span> <span class="n">to</span> <span class="n">measure</span> <span class="n">a</span> <span class="n">PAPI</span> <span class="n">counter</span>
<span class="n">of</span> <span class="n">callsite</span> <span class="k">while</span> <span class="n">running</span> <span class="n">original</span> <span class="n">application</span><span class="o">.</span> <span class="n">KGen</span> <span class="n">uses</span>
<span class="n">the</span> <span class="n">measruments</span> <span class="n">to</span> <span class="n">automatically</span> <span class="n">generate</span> <span class="n">invocation</span>
<span class="n">triplets</span><span class="o">.</span> <span class="n">This</span> <span class="n">option</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="k">with</span> <span class="n">other</span> <span class="s2">&quot;repr-&quot;</span>
<span class="n">options</span><span class="o">.</span> <span class="n">Current</span> <span class="n">KGen</span> <span class="n">version</span> <span class="n">tries</span> <span class="n">select</span> <span class="n">invocation</span>
<span class="n">triplets</span> <span class="n">such</span> <span class="n">a</span> <span class="n">way</span> <span class="n">to</span> <span class="n">improve</span> <span class="n">kernel</span> <span class="n">representativeness</span>
<span class="ow">in</span> <span class="n">terms</span> <span class="n">of</span> <span class="n">distribution</span> <span class="n">of</span> <span class="n">the</span> <span class="n">measurments</span><span class="o">.</span> <span class="n">There</span> <span class="n">are</span>
<span class="n">several</span> <span class="n">sub</span><span class="o">-</span><span class="n">flags</span> <span class="n">that</span> <span class="n">control</span> <span class="n">specific</span> <span class="n">aspects</span> <span class="n">of</span> <span class="n">this</span> <span class="n">option</span><span class="o">.</span>
<span class="s2">&quot;enable&quot;</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span> <span class="n">turns</span> <span class="n">on</span> <span class="n">this</span> <span class="n">feature</span><span class="o">.</span> <span class="s2">&quot;enable&quot;</span> <span class="ow">is</span> <span class="ow">not</span>
<span class="n">needed</span> <span class="k">if</span> <span class="n">other</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span> <span class="ow">is</span> <span class="n">specified</span><span class="o">.</span> <span class="s2">&quot;disable&quot;</span> <span class="n">turns</span> <span class="n">off</span>
<span class="n">this</span> <span class="n">feature</span><span class="o">.</span> <span class="n">Default</span> <span class="n">setting</span> <span class="ow">is</span> <span class="s2">&quot;disable&quot;</span><span class="o">.</span> <span class="n">There</span> <span class="n">are</span> <span class="n">three</span>
<span class="n">mandatory</span> <span class="n">sub</span><span class="o">-</span><span class="n">flags</span> <span class="n">when</span> <span class="n">use</span> <span class="n">this</span> <span class="n">option</span><span class="p">:</span> <span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="s2">&quot;static&quot;</span><span class="p">,</span>
<span class="ow">and</span> <span class="s2">&quot;event&quot;</span><span class="o">.</span> <span class="n">User</span> <span class="n">provides</span> <span class="n">the</span> <span class="n">location</span> <span class="n">of</span> <span class="n">Fortran</span> <span class="n">papi</span> <span class="n">header</span>
<span class="n">files</span> <span class="n">using</span> <span class="s2">&quot;header&quot;</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span><span class="o">.</span> <span class="s2">&quot;static&quot;</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span> <span class="n">indicates</span>
<span class="n">the</span> <span class="n">location</span> <span class="n">of</span> <span class="n">Fortran</span> <span class="n">PAPI</span> <span class="n">static</span> <span class="n">library</span><span class="o">.</span> <span class="n">And</span> <span class="n">lastly</span>
<span class="s2">&quot;event&quot;</span> <span class="n">sets</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">PAPI</span> <span class="n">event</span> <span class="n">to</span> <span class="n">be</span> <span class="n">collected</span><span class="o">.</span> <span class="s2">&quot;minval&quot;</span>
<span class="ow">and</span> <span class="s2">&quot;maxval&quot;</span> <span class="n">sub</span><span class="o">-</span><span class="n">flags</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">lower</span> <span class="ow">and</span> <span class="n">upper</span> <span class="n">bounds</span> <span class="n">of</span>
<span class="n">measurements</span><span class="o">.</span> <span class="n">By</span> <span class="n">setting</span> <span class="n">these</span> <span class="n">sub</span><span class="o">-</span><span class="n">flags</span><span class="p">,</span> <span class="n">user</span> <span class="n">can</span> <span class="n">manually</span>
<span class="n">exclude</span> <span class="s2">&quot;outliers&quot;</span> <span class="n">that</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">likely</span> <span class="n">part</span> <span class="n">of</span> <span class="n">measurements</span><span class="o">.</span>
<span class="s2">&quot;ndata&quot;</span> <span class="n">sets</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">invocation</span> <span class="n">triplets</span> <span class="n">that</span> <span class="n">KGen</span>
<span class="n">automatically</span> <span class="n">genrates</span><span class="o">.</span> <span class="s2">&quot;nbins&quot;</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span>
<span class="n">elapsed</span> <span class="n">time</span> <span class="n">ranges</span> <span class="n">that</span> <span class="n">controls</span> <span class="n">resolution</span> <span class="n">of</span> <span class="n">distribution</span><span class="o">.</span>
<span class="n">It</span> <span class="n">should</span> <span class="n">be</span> <span class="n">noted</span> <span class="n">that</span> <span class="n">this</span> <span class="n">PAPI</span> <span class="n">counter</span> <span class="n">collection</span> <span class="ow">is</span> <span class="ow">not</span>
<span class="n">fully</span> <span class="n">automated</span> <span class="ow">in</span> <span class="n">that</span> <span class="n">user</span> <span class="n">has</span> <span class="n">to</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">that</span> <span class="n">original</span>
<span class="n">application</span> <span class="ow">is</span> <span class="n">linked</span> <span class="k">with</span> <span class="n">PAPI</span> <span class="n">library</span><span class="o">.</span> <span class="n">Please</span> <span class="n">see</span>
<span class="n">representative</span> <span class="n">section</span> <span class="k">for</span> <span class="n">details</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="nb">repr</span><span class="o">-</span><span class="n">papi</span> <span class="n">header</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">f90papi</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
    <span class="n">static</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libpapi</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="n">minval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">maxval</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">ndata</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">nbins</span><span class="o">=</span><span class="mi">5</span>
</pre></div>
</div>
<p>[- -repr-code]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span> <span class="p">:</span> <span class="n">this</span> <span class="n">option</span> <span class="n">enables</span> <span class="n">to</span> <span class="n">measure</span> <span class="n">source</span> <span class="n">code</span> <span class="n">coverage</span>
<span class="n">of</span> <span class="n">kernel</span> <span class="k">while</span> <span class="n">running</span> <span class="n">original</span> <span class="n">application</span> <span class="ow">and</span> <span class="n">produces</span>
<span class="n">summary</span> <span class="n">of</span> <span class="n">coverage</span> <span class="n">information</span><span class="o">.</span> <span class="n">KGen</span> <span class="n">uses</span> <span class="n">the</span> <span class="n">measruments</span>
<span class="n">to</span> <span class="n">automatically</span> <span class="n">generate</span> <span class="n">invocation</span> <span class="n">triplets</span><span class="o">.</span> <span class="n">This</span> <span class="n">option</span> <span class="n">can</span>
<span class="n">be</span> <span class="n">used</span> <span class="k">with</span> <span class="n">other</span> <span class="s2">&quot;repr-&quot;</span> <span class="n">options</span><span class="o">.</span> <span class="n">Current</span> <span class="n">KGen</span> <span class="n">version</span> <span class="n">tries</span>
<span class="n">select</span> <span class="n">invocation</span> <span class="n">triplets</span> <span class="n">such</span> <span class="n">a</span> <span class="n">way</span> <span class="n">to</span> <span class="n">improve</span> <span class="n">kernel</span>
<span class="n">representativeness</span> <span class="ow">in</span> <span class="n">terms</span> <span class="n">of</span> <span class="n">coverage</span> <span class="n">percentage</span> <span class="n">of</span> <span class="n">kernel</span>
<span class="n">compared</span> <span class="n">to</span> <span class="nb">all</span> <span class="n">Fortran</span> <span class="s2">&quot;IF&quot;</span> <span class="n">blocks</span> <span class="n">of</span> <span class="n">corresponding</span> <span class="n">code</span>
<span class="n">within</span> <span class="n">original</span> <span class="n">application</span><span class="o">.</span> <span class="n">There</span> <span class="n">are</span> <span class="n">three</span> <span class="n">sub</span><span class="o">-</span><span class="n">flags</span> <span class="n">defined</span>
<span class="ow">in</span> <span class="n">this</span> <span class="n">version</span> <span class="n">of</span> <span class="n">KGen</span><span class="o">.</span> <span class="s2">&quot;enable&quot;</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span> <span class="n">enables</span> <span class="n">this</span> <span class="n">feature</span><span class="o">.</span>
<span class="s2">&quot;disable&quot;</span> <span class="n">turns</span> <span class="n">off</span> <span class="n">this</span> <span class="n">feature</span><span class="p">,</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">default</span> <span class="n">setting</span> <span class="n">of</span>
<span class="n">this</span> <span class="n">option</span><span class="o">.</span> <span class="s2">&quot;percentage&quot;</span> <span class="n">sub</span><span class="o">-</span><span class="n">flag</span> <span class="n">sets</span> <span class="n">the</span> <span class="n">minimum</span> <span class="n">code</span>
<span class="n">coverage</span> <span class="n">achieved</span> <span class="kn">from</span> <span class="nn">a</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">invocation</span> <span class="n">triples</span> <span class="n">generated</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="nb">repr</span><span class="o">-</span><span class="n">code</span> <span class="n">percentage</span><span class="o">=</span><span class="mi">99</span>
</pre></div>
</div>
<p>[- -state-switch]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span> <span class="p">:</span> <span class="n">this</span> <span class="n">option</span> <span class="n">controls</span> <span class="n">state</span> <span class="n">generation</span> <span class="n">task</span><span class="o">.</span> <span class="n">There</span> <span class="n">are</span>
    <span class="n">three</span> <span class="n">sub</span><span class="o">-</span><span class="n">options</span><span class="p">:</span> <span class="n">clean</span><span class="p">,</span> <span class="nb">type</span> <span class="ow">and</span> <span class="n">directory</span><span class="o">.</span> <span class="s2">&quot;clean&quot;</span> <span class="n">forces</span> <span class="n">to</span>
<span class="n">remove</span> <span class="n">previously</span> <span class="n">generated</span> <span class="n">ouputs</span><span class="o">.</span> <span class="n">In</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">there</span> <span class="n">are</span> <span class="n">two</span>
<span class="n">attributes</span><span class="p">:</span> <span class="n">replace</span> <span class="ow">or</span> <span class="n">copy</span><span class="o">.</span> <span class="s2">&quot;replace&quot;</span> <span class="n">forces</span> <span class="n">the</span> <span class="n">original</span> <span class="n">source</span>
    <span class="n">file</span> <span class="ow">is</span> <span class="n">replaced</span> <span class="k">with</span> <span class="n">the</span> <span class="n">KGen</span><span class="o">-</span><span class="n">generated</span> <span class="n">source</span> <span class="n">file</span><span class="o">.</span> <span class="s2">&quot;copy&quot;</span>
    <span class="n">forces</span> <span class="n">to</span> <span class="n">copy</span> <span class="n">KGen</span><span class="o">-</span><span class="n">generated</span> <span class="n">source</span> <span class="n">files</span> <span class="n">into</span> <span class="n">a</span> <span class="n">directory</span> <span class="n">that</span>
<span class="ow">is</span> <span class="n">specified</span> <span class="n">by</span> <span class="s2">&quot;directory&quot;</span> <span class="n">sub</span><span class="o">-</span><span class="n">option</span> <span class="n">of</span> <span class="s2">&quot;--state-switch&quot;</span> <span class="n">option</span><span class="o">.</span>
    <span class="n">default</span> <span class="n">sub</span><span class="o">-</span><span class="n">option</span> <span class="ow">is</span> <span class="s2">&quot;replace&quot;</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">state</span><span class="o">-</span><span class="n">switch</span> <span class="n">clean</span><span class="o">=</span><span class="s2">&quot;rm ./strace.log&quot;</span>
</pre></div>
</div>
<p>[- -noreuse-rawdata]</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">meaning</span> <span class="p">:</span> <span class="n">Use</span> <span class="n">this</span> <span class="n">option</span> <span class="k">if</span> <span class="n">re</span><span class="o">-</span><span class="n">generating</span> <span class="n">raw</span> <span class="n">data</span> <span class="ow">is</span> <span class="n">desired</span><span class="o">.</span>

<span class="n">example</span><span class="p">)</span> <span class="o">--</span><span class="n">noreuse</span><span class="o">-</span><span class="n">rawdata</span>
</pre></div>
</div>
</div>
<div class="section" id="known-issues">
<h2>5. Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h2>
<p>Only subset of Fortran specification is supported.
A variable of assumed size array is not supported for state generation
File I/O and MPI communication in KGen-generated kernel is not supported
Cyclic linked list is not supported.
Pointer variable that is associated with part of input state to the kernel may ( or may not) generate issues depending on the usage of the variable within the extracted kernel</p>
</div>
<div class="section" id="changes-from-kgen-ver-0-7-2">
<h2>6. Changes from KGen ver. 0.7.2<a class="headerlink" href="#changes-from-kgen-ver-0-7-2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="user-interface">
<h3>6.1 User Interface<a class="headerlink" href="#user-interface" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>&#8220;&#8211;invocation&#8221; option is changed from mandatory to optional</li>
<li>&#8220;&#8211;repr-etime&#8221;, &#8220;&#8211;repr-papi&#8221;, and &#8220;&#8211;repr-code&#8221; options are added for representative extensions</li>
<li>&#8220;&#8211;state-clean&#8221;, &#8220;&#8211;state-build&#8221;, and &#8220;&#8211;state-run&#8221; options are discarded.</li>
</ul>
</div>
<div class="section" id="major-improvements">
<h3>6.2 Major Improvements<a class="headerlink" href="#major-improvements" title="Permalink to this headline">¶</a></h3>
<p>KGen measures three types of characteristics from original application and generates kernel and input data in a way to reprouce the types of characteristics in generated kernel.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="developer/index.html" class="btn btn-neutral float-right" title="Developer Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial/index.html" class="btn btn-neutral" title="Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, KGen Developers.
      Last updated on Jul 31, 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.8.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>